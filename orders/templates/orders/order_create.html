{% extends 'base.html' %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h3 class="card-title mb-0"><i class="fas fa-plus-circle"></i> Yangi Buyurtma Kiritish</h3>
        </div>
        <div class="card-body">
            <form method="post" enctype="multipart/form-data" id="orderForm">
                {% csrf_token %}
                {% if form.errors %}
            <div class="alert alert-danger">
                <strong>Xatoliklarni tuzating:</strong>
                <ul>
                    {% for field in form %}
                        {% for error in field.errors %}
                            <li>{{ field.label }}: {{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                    {% for error in form.non_field_errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
                <div class="row">
                    <div class="col-md-6 border-right">
                        <h5 class="text-secondary border-bottom pb-2">Asosiy Ma'lumotlar</h5>
                        <div class="mb-3">
                            <label class="form-label font-weight-bold">PDF Chizma (Majburiy)</label>
                            {{ form.pdf_file }}
                        </div>
                        <div class="row">
                            <div class="col-6 mb-3">
                                <label>Mijoz ID</label>
                                {{ form.customer_unique_id }}
                            </div>
                            <div class="col-6 mb-3">
                                <label>Xaridor Nomi</label>
                                {{ form.customer_name }}
                            </div>
                        </div>
                        <div class="mb-3">
                            <label>Mahsulot Nomi</label>
                            {{ form.product_name }}
                        </div>
                        <div class="mb-3">
                            <label class="text-danger font-weight-bold">Ish Turi (Navbatdagi Usta)</label>
                            {{ form.worker_type }}
                        </div>
                    </div>

                    <div class="col-md-6">
                        <h5 class="text-secondary border-bottom pb-2">Texnik Parametrlar</h5>
                        
                        <div id="eshik_fields" style="display:none;" class="p-3 bg-warning-light border rounded mb-3">
                            <h6><i class="fas fa-door-open"></i> Eshik Ma'lumotlari</h6>
                            <div class="mb-2">
                                <label>Eshik Turi</label>
                                {{ form.eshik_turi }}
                            </div>
                            <div class="form-check">
                                {{ form.zamokli_eshik }}
                                <label class="form-check-label">Zamokli eshikmi?</label>
                            </div>
                        </div>

                        <div id="panel_fields" style="display:none;" class="p-3 bg-info-light border rounded mb-3">
                            <h6><i class="fas fa-layer-group"></i> Panel Ma'lumotlari</h6>
                            <div class="row">
                                <div class="col-6 mb-2">{{ form.panel_type.label }}{{ form.panel_type }}</div>
                                <div class="col-6 mb-2">{{ form.panel_subtype.label }}{{ form.panel_subtype }}</div>
                                <div class="col-6 mb-2">{{ form.panel_thickness.label }}{{ form.panel_thickness }}</div>
                                <div class="col-6 mb-2">Kvadrat (mÂ²){{ form.panel_kvadrat }}</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label>Ustalar (Bir nechta tanlash mumkin)</label>
                            <div class="border p-2 rounded bg-light" style="max-height: 150px; overflow-y: auto;">
                                {{ form.assigned_workers }}
                            </div>
                        </div>
                    </div>
                </div>

                <hr>
                
                <div class="row">
                    <div class="col-md-4 mb-3"><label>Umumiy Narx</label>{{ form.total_price }}</div>
                    <div class="col-md-4 mb-3"><label>Zalog</label>{{ form.prepayment }}</div>
                    <div class="col-md-4 mb-3"><label>Deadline</label>{{ form.deadline }}</div>
                </div>

                <div class="mb-3">
                    <label>Admin Izohi</label>
                    {{ form.comment }}
                </div>

                <div class="d-flex justify-content-end">
                    <a href="{% url 'order_list' %}" class="btn btn-secondary me-2">Bekor qilish</a>
                    <button type="submit" class="btn btn-success px-5">Buyurtmani Saqlash</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const workerTypeSelect = document.getElementById('id_worker_type');
        const eshikFields = document.getElementById('eshik_fields');
        const panelFields = document.getElementById('panel_fields');

        function toggleFields() {
            const val = workerTypeSelect.value;
            // ESHIK yoki LIST_ESHIK bo'lsa eshik maydonlarini ko'rsat
            if (val === 'ESHIK' || val === 'LIST_ESHIK') {
                eshikFields.style.display = 'block';
            } else {
                eshikFields.style.display = 'none';
            }

            // LIST yoki LIST_ESHIK bo'lsa panel maydonlarini ko'rsat
            if (val === 'LIST' || val === 'LIST_ESHIK') {
                panelFields.style.display = 'block';
            } else {
                panelFields.style.display = 'none';
            }
        }

        workerTypeSelect.addEventListener('change', toggleFields);
        toggleFields(); // Sahifa yuklanganda ishlashi uchun
    });
</script>

<style>
    .bg-warning-light { background-color: #fff9e6; }
    .bg-info-light { background-color: #e6f7ff; }
    label { font-weight: 500; font-size: 0.9rem; }
</style>
{% endblock %}
